diff --git a/scripts/setlocalversion b/scripts/setlocalversion
index 46989b8..887960f 100755
--- a/scripts/setlocalversion
+++ b/scripts/setlocalversion
@@ -18,6 +18,7 @@ cd "${1:-.}" || usage
 
 # Check for git and a git repo.
 if head=`git rev-parse --verify --short HEAD 2>/dev/null`; then
+if [ `git rev-parse --git-dir` = ".git" ]; then
 
 	# If we are at a tagged commit (like "v2.6.30-rc6"), we ignore it,
 	# because this version is defined in the top level Makefile.
@@ -51,6 +52,7 @@ if head=`git rev-parse --verify --short HEAD 2>/dev/null`; then
 	# All done with git
 	exit
 fi
+fi
 
 # Check for mercurial and a mercurial repo.
 if hgid=`hg id 2>/dev/null`; then
